(this["webpackJsonpreact-mediapipe-video"]=this["webpackJsonpreact-mediapipe-video"]||[]).push([[0],{27:function(e,t,n){},28:function(e,t,n){},29:function(e,t,n){},31:function(e,t,n){},33:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(18),i=n.n(a),o=(n(27),n(28),n(29),n(1)),u=function(){return Object(o.jsxs)("div",{className:"home-container",children:[Object(o.jsx)("h1",{children:"Face Segmentation with MediaPipe and React!"}),Object(o.jsx)("h2",{children:"Done in order to apply to MoodMe"}),Object(o.jsx)("h3",{children:"Uriel Tejeiro"})]})},s=n(11),d=(n(31),n(5)),l=n.n(d),j=n(8),h=n(9),f=n.n(h),b=n(19),m=n(10),g=function(){var e=Object(r.useRef)(null),t=Object(r.useState)(!1),n=Object(s.a)(t,2),c=n[0],a=n[1],i=Object(r.useRef)(c),u=Object(r.useRef)(null),d=Object(r.useRef)(null),h=Object(r.useRef)({current:null});function g(e){var t=u.current.video.videoWidth,n=u.current.video.videoHeight;d.current.width=t,d.current.height=n;var r=d.current,c=r.getContext("2d");c.save(),c.clearRect(0,0,r.width,r.height),c.globalCompositeOperation="copy",c.filter="blur(16px)",c.drawImage(e.segmentationMask,0,0,r.width,r.height),c.globalCompositeOperation="source-in",c.filter="none",c.drawImage(e.image,0,0,r.width,r.height),c.globalCompositeOperation="destination-atop",c.filter=i.current?"none":"blur(15px)",c.drawImage(i.current?h.current:e.image,0,0,r.width,r.height),c.restore()}Object(r.useEffect)((function(){var t=new b.SelfieSegmentation({locateFile:function(e){return"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/".concat(e)}});if(e.current=t,t.setOptions({modelSelection:1}),t.onResults(g),"undefined"!==typeof u.current&&null!==u.current){var n=document.createElement("img",{ref:h});n.objectFit="contain",n.onload=function(){h.current=n,u.current.video.crossOrigin="anonymous",new m.Camera(u.current.video,{onFrame:function(){var e=Object(j.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=u.current,!e.t0){e.next=4;break}return e.next=4,t.send({image:u.current.video});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),width:640,height:480}).start()},n.src="images/architecture.jpg"}}),[]);Object(r.useEffect)((function(){return function(){e&&e.current.close()}}),[]),Object(r.useEffect)((function(){i.current=c}),[c]);var O=function(e){switch(e.target.value){case"blur":a(!1);break;case"virtual":a(!0);break;default:a(!1)}};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)("div",{className:"select-bg",children:[Object(o.jsxs)("label",{children:[Object(o.jsx)("input",{type:"radio",value:"blur",checked:!c,onChange:O}),"Blur Background"]}),Object(o.jsxs)("label",{children:[Object(o.jsx)("input",{type:"radio",value:"virtual",checked:c,onChange:O}),"Virtual Background"]})]}),Object(o.jsx)(f.a,{ref:u,videoConstraints:{facingMode:"user"}}),Object(o.jsx)("canvas",{ref:d,className:"output_canvas"})]})},O=n(20),p=function(){var e=Object(r.useRef)(null),t=Object(r.useRef)(null),n=Object(r.useRef)(null),c=Object(r.useRef)({current:null});function a(e){var r=t.current.video.videoWidth,a=t.current.video.videoHeight;n.current.width=r,n.current.height=a;var i=n.current,o=i.getContext("2d");if(o.clearRect(0,0,i.width,i.height),o.drawImage(e.image,0,0,i.width,i.height),e.multiFaceLandmarks.length>0){var u=e.multiFaceLandmarks[0],s=Math.abs(u[234].x*r-u[454].x*r),d=Math.abs(u[234].y*a-u[152].y*a)+10;c.current.width="".concat(s),c.current.height="".concat(d),o.drawImage(c.current,u[234].x*r,u[234].y*a-10,s,d)}}Object(r.useEffect)((function(){var n=new O.FaceMesh({locateFile:function(e){return"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/".concat(e)}});if(e.current=n,n.setOptions({maxNumFaces:1,minDetectionConfidence:.5,minTrackingConfidence:.5}),n.onResults(a),"undefined"!==typeof t.current&&null!==t.current){var r=document.createElement("img",{ref:c});r.objectFit="contain",r.onload=function(){c.current=r,t.current.video.crossOrigin="anonymous",new m.Camera(t.current.video,{onFrame:function(){var e=Object(j.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.current,!e.t0){e.next=4;break}return e.next=4,n.send({image:t.current.video});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),width:640,height:480}).start()},r.src="images/mask4.png"}}),[]);return Object(r.useEffect)((function(){return function(){e.current&&e.current.close()}}),[]),Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(f.a,{ref:t}),Object(o.jsx)("canvas",{ref:n,className:"output_canvas"})]})};var v=function(){var e=Object(r.useState)(!1),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(o.jsxs)("div",{className:"container-face-segmentation",children:[Object(o.jsx)("h2",{children:"Using MediaPipe"}),"Switch to Mode: ",Object(o.jsx)("button",{onClick:function(){return c(!n)},children:n?"Face Filter Effect":"Background Manipulation and Blur Background"}),Object(o.jsx)("br",{}),Object(o.jsx)("br",{}),n?Object(o.jsx)(g,{}):Object(o.jsx)(p,{})]})};n(33);function x(){return Object(o.jsx)("div",{className:"error-page-container",children:Object(o.jsx)("h1",{className:"error-message",children:"404 Error: Page Not Found"})})}var w=n(12),k=n(2);var F=function(){return Object(o.jsx)(w.a,{children:Object(o.jsxs)(k.c,{children:[Object(o.jsxs)(k.a,{exact:!0,path:"/",children:[Object(o.jsx)(u,{}),Object(o.jsx)(w.b,{className:"button",to:"/face-segmentation",children:"Face Segmentation"})]}),Object(o.jsxs)(k.a,{path:"/face-segmentation",children:[Object(o.jsx)(v,{}),Object(o.jsx)(w.b,{className:"button",to:"/",children:"Home"})]}),Object(o.jsx)(k.a,{path:"/error-page",children:Object(o.jsx)(x,{})})]})})};i.a.render(Object(o.jsx)(c.a.StrictMode,{children:Object(o.jsx)(F,{})}),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.f3a54f83.chunk.js.map
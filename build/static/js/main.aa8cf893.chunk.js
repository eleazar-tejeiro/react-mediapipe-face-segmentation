(this["webpackJsonpreact-mediapipe-video"]=this["webpackJsonpreact-mediapipe-video"]||[]).push([[0],{27:function(e,t,n){},28:function(e,t,n){},29:function(e,t,n){},31:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),i=n(18),a=n.n(i),u=(n(27),n(28),n(29),n(1)),o=function(){return Object(u.jsxs)("div",{className:"home-container",children:[Object(u.jsx)("h1",{children:"Face Segmentation with MediaPipe and React!"}),Object(u.jsx)("h2",{children:"Done in order to apply to MoodMe"}),Object(u.jsx)("h3",{children:"Uriel Tejeiro"})]})},s=n(11),d=(n(31),n(5)),l=n.n(d),j=n(8),h=n(9),f=n.n(h),b=n(19),m=n(10),g=function(){var e=Object(r.useRef)(null),t=Object(r.useState)(!1),n=Object(s.a)(t,2),c=n[0],i=n[1],a=Object(r.useRef)(c),o=Object(r.useRef)(null),d=Object(r.useRef)(null),h=Object(r.useRef)({current:null});function g(e){var t=o.current.video.videoWidth,n=o.current.video.videoHeight;d.current.width=t,d.current.height=n;var r=d.current,c=r.getContext("2d");c.save(),c.clearRect(0,0,r.width,r.height),c.globalCompositeOperation="copy",c.filter="blur(16px)",c.drawImage(e.segmentationMask,0,0,r.width,r.height),c.globalCompositeOperation="source-in",c.filter="none",c.drawImage(e.image,0,0,r.width,r.height),c.globalCompositeOperation="destination-atop",c.filter=a.current?"none":"blur(15px)",c.drawImage(a.current?h.current:e.image,0,0,r.width,r.height),c.restore()}Object(r.useEffect)((function(){var t=new b.SelfieSegmentation({locateFile:function(e){return"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/".concat(e)}});if(e.current=t,t.setOptions({modelSelection:1}),t.onResults(g),"undefined"!==typeof o.current&&null!==o.current){var n=document.createElement("img",{ref:h});n.objectFit="contain",n.onload=function(){h.current=n,o.current.video.crossOrigin="anonymous",new m.Camera(o.current.video,{onFrame:function(){var e=Object(j.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=o.current,!e.t0){e.next=4;break}return e.next=4,t.send({image:o.current.video});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),width:640,height:480}).start()},n.src="images/architecture.jpg"}}),[]);Object(r.useEffect)((function(){return function(){e&&e.current.close()}}),[]),Object(r.useEffect)((function(){a.current=c}),[c]);var O=function(e){switch(e.target.value){case"blur":i(!1);break;case"virtual":i(!0);break;default:i(!1)}};return Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("div",{className:"select-bg",children:[Object(u.jsxs)("label",{children:[Object(u.jsx)("input",{type:"radio",value:"blur",checked:!c,onChange:O}),"Blur Background"]}),Object(u.jsxs)("label",{children:[Object(u.jsx)("input",{type:"radio",value:"virtual",checked:c,onChange:O}),"Virtual Background"]})]}),Object(u.jsx)(f.a,{ref:o,videoConstraints:{facingMode:"user"}}),Object(u.jsx)("canvas",{ref:d,className:"output_canvas"})]})},O=n(20),p=function(){var e=Object(r.useRef)(null),t=Object(r.useRef)(null),n=Object(r.useRef)(null),c=Object(r.useRef)({current:null});function i(e){var r=t.current.video.videoWidth,i=t.current.video.videoHeight;n.current.width=r,n.current.height=i;var a=n.current,u=a.getContext("2d");if(u.clearRect(0,0,a.width,a.height),u.drawImage(e.image,0,0,a.width,a.height),e.multiFaceLandmarks.length>0){var o=e.multiFaceLandmarks[0],s=Math.abs(o[234].x*r-o[454].x*r),d=Math.abs(o[234].y*i-o[152].y*i)+10;c.current.width="".concat(s),c.current.height="".concat(d),u.drawImage(c.current,o[234].x*r,o[234].y*i-10,s,d)}}Object(r.useEffect)((function(){var n=new O.FaceMesh({locateFile:function(e){return"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/".concat(e)}});if(e.current=n,n.setOptions({maxNumFaces:1,minDetectionConfidence:.5,minTrackingConfidence:.5}),n.onResults(i),"undefined"!==typeof t.current&&null!==t.current){var r=document.createElement("img",{ref:c});r.objectFit="contain",r.onload=function(){c.current=r,t.current.video.crossOrigin="anonymous",new m.Camera(t.current.video,{onFrame:function(){var e=Object(j.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.current,!e.t0){e.next=4;break}return e.next=4,n.send({image:t.current.video});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),width:640,height:480}).start()},r.src="images/mask4.png"}}),[]);return Object(r.useEffect)((function(){return function(){e.current&&e.current.close()}}),[]),Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)(f.a,{ref:t}),Object(u.jsx)("canvas",{ref:n,className:"output_canvas"})]})};var v=function(){var e=Object(r.useState)(!1),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(u.jsxs)("div",{className:"container-face-segmentation",children:[Object(u.jsx)("h2",{children:"Using MediaPipe"}),"Switch to Mode: ",Object(u.jsx)("button",{onClick:function(){return c(!n)},children:n?"Face Filter Effect":"Background Manipulation and Blur Background"}),Object(u.jsx)("br",{}),Object(u.jsx)("br",{}),n?Object(u.jsx)(g,{}):Object(u.jsx)(p,{})]})},x=n(12),w=n(2);var k=function(){return Object(u.jsx)(x.a,{children:Object(u.jsxs)(w.c,{children:[Object(u.jsxs)(w.a,{exact:!0,path:"/",children:[Object(u.jsx)(o,{}),Object(u.jsx)(x.b,{className:"button",to:"/face-segmentation",children:"Face Segmentation"})]}),Object(u.jsxs)(w.a,{path:"/face-segmentation",children:[Object(u.jsx)(v,{}),Object(u.jsx)(x.b,{className:"button",to:"/",children:"Home"})]})]})})};a.a.render(Object(u.jsx)(c.a.StrictMode,{children:Object(u.jsx)(k,{})}),document.getElementById("root"))}},[[37,1,2]]]);
//# sourceMappingURL=main.aa8cf893.chunk.js.map
(this["webpackJsonpreact-mediapipe-face-segmentation"]=this["webpackJsonpreact-mediapipe-face-segmentation"]||[]).push([[0],{27:function(e,t,n){},28:function(e,t,n){},29:function(e,t,n){},31:function(e,t,n){},33:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n(18),i=n.n(c),a=(n(27),n(28),n(29),n(1)),o=function(){return Object(a.jsxs)("div",{className:"home-container",children:[Object(a.jsx)("h1",{children:"Face Segmentation with MediaPipe and React!"}),Object(a.jsx)("h2",{children:"Done in order to apply to MoodMe"}),Object(a.jsx)("h3",{children:"Uriel Tejeiro"})]})},s=n(11),u=(n(31),n(5)),l=n.n(u),d=n(8),f=n(9),h=n.n(f),j=n(19),b=n(10),g=function(){var e=Object(r.useRef)(null),t=Object(r.useState)(!1),n=Object(s.a)(t,2),c=n[0],i=n[1],o=Object(r.useRef)(c),u=Object(r.useRef)(null),f=Object(r.useRef)(null),g=Object(r.useRef)({current:null});function m(e){var t=u.current.video.videoWidth,n=u.current.video.videoHeight;f.current.width=t,f.current.height=n;var r=f.current,c=r.getContext("2d");c.save(),c.clearRect(0,0,r.width,r.height),c.globalCompositeOperation="copy",c.filter="blur(16px)",c.drawImage(e.segmentationMask,0,0,r.width,r.height),c.globalCompositeOperation="source-in",c.filter="none",c.drawImage(e.image,0,0,r.width,r.height),c.globalCompositeOperation="destination-atop",c.filter=o.current?"none":"blur(15px)",c.drawImage(o.current?g.current:e.image,0,0,r.width,r.height),c.restore()}Object(r.useEffect)((function(){var t=new j.SelfieSegmentation({locateFile:function(e){return"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/".concat(e)}});if(e.current=t,t.setOptions({modelSelection:1}),t.onResults(m),"undefined"!==typeof u.current&&null!==u.current){var n=document.createElement("img",{ref:g});n.objectFit="contain",n.onload=function(){g.current=n,u.current.video.crossOrigin="anonymous",new b.Camera(u.current.video,{onFrame:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=u.current,!e.t0){e.next=4;break}return e.next=4,t.send({image:u.current.video});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),width:640,height:480}).start()},n.src="images/architecture.jpg"}}),[]);Object(r.useEffect)((function(){return function(){e&&e.current.close()}}),[]),Object(r.useEffect)((function(){o.current=c}),[c]);var v=function(e){switch(e.target.value){case"blur":i(!1);break;case"virtual":i(!0);break;default:i(!1)}};return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsxs)("div",{className:"select-bg",children:[Object(a.jsxs)("label",{children:[Object(a.jsx)("input",{type:"radio",value:"blur",checked:!c,onChange:v}),"Blur Background"]}),Object(a.jsxs)("label",{children:[Object(a.jsx)("input",{type:"radio",value:"virtual",checked:c,onChange:v}),"Virtual Background"]})]}),Object(a.jsx)(h.a,{ref:u,videoConstraints:{facingMode:"user"}}),Object(a.jsx)("canvas",{ref:f,className:"output_canvas"})]})},m=n(20),v=function(){var e=Object(r.useRef)(null),t=Object(r.useRef)(null),n=Object(r.useRef)(null),c=Object(r.useRef)({current:null});function i(e){var r=t.current.video.videoWidth,i=t.current.video.videoHeight;n.current.width=r,n.current.height=i;var a=n.current,o=a.getContext("2d");if(o.clearRect(0,0,a.width,a.height),o.drawImage(e.image,0,0,a.width,a.height),e.multiFaceLandmarks.length>0){var s=e.multiFaceLandmarks[0],u=Math.abs(s[234].x*r-s[454].x*r),l=Math.abs(s[234].y*i-s[152].y*i)+10;c.current.width="".concat(u),c.current.height="".concat(l),o.drawImage(c.current,s[234].x*r,s[234].y*i-10,u,l)}}Object(r.useEffect)((function(){var n=new m.FaceMesh({locateFile:function(e){return"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/".concat(e)}});if(e.current=n,n.setOptions({maxNumFaces:1,minDetectionConfidence:.5,minTrackingConfidence:.5}),n.onResults(i),"undefined"!==typeof t.current&&null!==t.current){var r=document.createElement("img",{ref:c});r.objectFit="contain",r.onload=function(){c.current=r,t.current.video.crossOrigin="anonymous",new b.Camera(t.current.video,{onFrame:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.current,!e.t0){e.next=4;break}return e.next=4,n.send({image:t.current.video});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),width:640,height:480}).start()},r.src="images/mask4.png"}}),[]);return Object(r.useEffect)((function(){return function(){e.current&&e.current.close()}}),[]),Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(h.a,{ref:t}),Object(a.jsx)("canvas",{ref:n,className:"output_canvas"})]})};var p=function(){var e=Object(r.useState)(!1),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(a.jsxs)("div",{className:"container-face-segmentation",children:[Object(a.jsx)("h2",{children:"Using MediaPipe"}),"Switch to Mode: ",Object(a.jsx)("button",{onClick:function(){return c(!n)},children:n?"Face Filter Effect":"Background Manipulation and Blur Background"}),Object(a.jsx)("br",{}),Object(a.jsx)("br",{}),n?Object(a.jsx)(g,{}):Object(a.jsx)(v,{})]})};n(33);function O(){return Object(a.jsx)("div",{className:"error-page-container",children:Object(a.jsx)("h1",{className:"error-message",children:"404 Error: Page Not Found"})})}var w=n(12),x=n(2);var k=function(){return Object(a.jsx)(w.a,{children:Object(a.jsxs)(x.c,{children:[Object(a.jsxs)(x.a,{exact:!0,path:"/",children:[Object(a.jsx)(o,{}),Object(a.jsx)(w.b,{className:"button",to:"/face-segmentation",children:"Face Segmentation"})]}),Object(a.jsxs)(x.a,{path:"/face-segmentation",children:[Object(a.jsx)(p,{}),Object(a.jsx)(w.b,{className:"button",to:"/",children:"Home"})]}),Object(a.jsx)(x.a,{path:"/",children:Object(a.jsx)(O,{})})]})})},y=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function F(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(Object(a.jsx)(k,{}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");y?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):F(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):F(t,e)}))}}()}},[[38,1,2]]]);
//# sourceMappingURL=main.c17c3321.chunk.js.map